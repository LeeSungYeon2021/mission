<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
						"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="wemb.mission.plan.dao.PlanDao">

	<!-- 일정 등록 -->
	<insert id="planInsert"
		parameterType="wemb.mission.plan.vo.Plan">
		INSERT INTO TB_PLAN
		VALUES(SEQ_PLAN.NEXTVAL,SYSDATE,#{plan_start_date},#{plan_end_date},SYSDATE,#{plan_title},#{plan_content},#{plan_state})
	</insert>

	<!-- 해당 월 일정 조회 -->
	<select id="planSelect" resultType="wemb.mission.plan.vo.Plan">		
		
		SELECT * FROM TB_PLAN WHERE PLAN_START_DATE LIKE '%'||#{SUBDAY}||'%' ORDER BY (CASE WHEN PLAN_STATE = 'Y' THEN 1 ELSE 2 END ),PLAN_ENROLL_DATE ASC  
	</select>

	<!-- 일정 카운트 조회 -->
	<select id="planCount"
		resultType="wemb.mission.plan.vo.PlanCount">
		SELECT A.*,B.MONTHCOUNT FROM 
			(SELECT PLAN_START_DATE,COUNT(*) AS DAYCOUNT FROM TB_PLAN WHERE PLAN_START_DATE LIKE '%'||#{SUBDAY}||'%' GROUP BY PLAN_START_DATE) A,
			(SELECT COUNT(*)AS MONTHCOUNT FROM TB_PLAN WHERE PLAN_START_DATE LIKE '%'||#{SUBDAY}||'%') B
	</select>
	
	<select id="planView" parameterType="_int" resultType="wemb.mission.plan.vo.Plan">
		SELECT * FROM TB_PLAN WHERE PLAN_SEQ_NO = #{no}
	</select>
	
	<update id="planUpdate" parameterType="wemb.mission.plan.vo.Plan">
		UPDATE TB_PLAN SET PLAN_START_DATE = #{plan_start_date} , PLAN_END_DATE = #{plan_end_date} , PLAN_UPDATE_DATE = SYSDATE , PLAN_TITLE = #{plan_title} ,
		PLAN_CONTENT = #{plan_content} , PLAN_STATE = #{plan_state} WHERE PLAN_SEQ_NO = #{plan_seq_no}
	</update>
	
	<delete id="planDelete" parameterType="_int">
		DELETE FROM TB_PLAN WHERE PLAN_SEQ_NO = #{plan_seq_no}
	</delete>
</mapper>